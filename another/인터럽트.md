2020.12.07

### 하드웨어 인터럽트

운영체제는 아무 일이 없는 경우 대기상태로 존재하게 된다.

이러한 상태의 운영체제는 **인터럽트(interrupt)**에 의해 깨어나서 서비스를 진행하게 된다.

인터럽트는 사전적으로 방해한다라는 뜻을 가지고 있는데, 이러한 경우에서는 CPU의 동작을 방해한다는 의미를 가지게 된다.

<br/>

인터럽트를 받은 CPU는 하던 일을 멈추고 ISR (Interrupt service routine) 으로 넘어가게 된다.

<br/>

**키보드, 마우스 등의 하드웨어 장치로 인하여 발생하는 인터럽트를 하드웨어 인터럽트라고 한다.**

- **CPU 가 인터럽트를 받았을 때에는 누가 신호를 보냈는지 파악하는 절차를 가진다.**

<br/>

**마우스로 어떠한 SW를 실행하는 경우**

- 마우스를 클릭하면 cpu가 그에 따른 인터럽트를 받고 마우스의 ISR 로 이동한다.
- 이후에는 ISR 내부의 코드를 실행하게 되는데, 이것은 운영체제의 코드를 의미한다.
- **이 코드로 인하여서 파일, 프로그램이 메모리에 적재된 이후에는 운영체제 코드가 아닌 해당 코드를 실행한다.**

<br/>

**키보드로 어떠한 문자를 입력했을 경우**

- 키보드를 클릭하면 cpu가 그에 따른 인터럽트를 받고 키보드의 ISR 로 이동한다.
- ISR 내부의 코드를 실행되고, 현재 키보드의 어떠한 키가 눌려졌는지 알게된다.
- **해당 키를 화면에 출력하고, 현재 입력의 대상이 되는 프로그램에게 해당 키 값을 넘겨준다.**

위와 같은 절차가 다 진행되게 되면, 운영체제는 대기상태로 다시 전환되며, 실행 중이였던 프로그램이 다음 시점부터 다시 CPU를 통해 구동되게 된다. 

**이러한 인터럽트를 외부 인터럽트의 I/O 인터럽트라고도 명칭한다.**

<br/>

### 소프트웨어 인터럽트

워드나 기타 프로그램 등이 완성된 문서, 파일, 정보를 프린터나 외부로 전송해야하는 경우 요청을 하여야 하는데 System call과 같은 명령을 사용하게 된다. 이러한 것을 소프트웨어 인터럽트라고 한다.

프린터 같은 경우 모든 프로그램에게 중복적으로 ISR를 탑재하는 것은 매우 비효율적이기 때문에 운영체제에서 해당 ISR을 담당하고 관리하게 된다.

<br/>

SW에서 운영체제에서 제공하는 서비스(여기서는 프린터)를 요청할 경우 운영체제는 프린터의 ISR에 접근하여 내부 코드를 실행하게 된다. 프린터와 관련된 프로세스가 메모리에 적재되면 해당 코드를 실행하면서 요청 값을 전달한다.

추가적으로

- SVC (Supervisor call : 프로그램 수행 중 문제가 생기면 운영체제에게 제어권을 넘기는 것)

라는 것도 존재한다.

<br/>

### 내부 인터럽트

그 외에도 운영체제가 실행되는 경우로는 내부 인터럽트라는 것이 있다. 해당 인터럽트는 주로 잘못된 동작에 의하여서 발생되는 것들로 이루어져있다.

이러한 인터럽트가 발생하면 오류 메시지를 출력하고 해당 프로그램을 강제로 종료하게 된다.

- divide by zero Interrupt (0으로 나누는 것)
- illegal instruction interrupt (존재하지 않는, 잘못된 기계어 명령의 경우)
- 기타 등등의 Exception

<br/>

### 외부 인터럽트

외부로부터의 요인을 통해 발생하는 인터럽트를 말한다.

- power fail interrupt (전원 이상)
- timer interrupt 등 (주기적인 인터럽트 실행)

<br/>

### **인터럽트 발생 처리 과정**

1. 프로그램 실행
2. 인터럽트 발생
3. 복귀 주소 저장 후 인터럽트 ISR로 이동
4. 인터럽트 로직 처리
5. 복귀 주소 가져오기
6. 실행되던 주소로 이동 (PC에 주솟값 대입)