2020.10.28

<br/>

**Serialization 직렬화?** 

- 객체의 상태를 영속화하는 메커니즘을 말한다.
- 객체를 다른 환경에 저장했다가 나중에 재구성 할 수 있게 만드는 과정

<br/>

**자바 직렬화?**

자바 시스템 내부의 객체나 데이터를 외부의 자바 시스템에서도 사용하게끔 Byte 형태로 Data를 변환하는 기술과 해당 Data를 객체로 변환하는 기술을 아울러 말한다.

- **JVM 메모리 내부의 객체를 Bytecode로 변환하고 다시 객체로 변환이 가능하다.**

**자바 직렬화의 조건?**

- **Primitive Type**
- **Serializeble 인터페이스를 상속받은 객체**

**언제 사용하는가?**

- **객체의 상태를 영속해야 할 필요가 있을 때 (File, DB, Cache)**
    - **Servlet Session (WAS) → 세션 자체를 직렬화 (파일, 클러스터링, DB 저장 등)**
    - **Cache → 저장된 객체를 찾아서 응답하게 하는 행위에서 직렬화하여 저장한다.**
- **외부 자바 시스템으로 객체를 전달할 필요가 있을 때**
    - 자바 직렬화는 자바 시스템에 최적화되어 있다.
    - 아무리 복잡하더라도 직렬화의 조건에 맞으면 바로 직렬화 가능하다.
- **RMI (Remote Method Invocation)**
    - **원격 시스템 간의 메시지 교환**을 위해 자바에서 지원하는 프로토콜이다.
    - **계층 별로 구현된 객체간의 메시지 전송**을 가능케 하기도 한다.
        - 구현하기 쉽다. (내부 소켓 통신을 숨기고 추상적인 메서드 호출로 처리한다.)
        - 신뢰성이 보장된다???
        - Java 라이브러리로 제공된다.
- Socket

**사용하는 방법?**

- 직렬화가 필요한 대상에 Serializable Interface를 Implements 한다.
- **ObjectOutputStream**을 만든 후 대상 객체를 **writeObject**(Object) 한다.
- byte[] serialzedObject를 만든 후 byteArrayOutputStream.**toByteArray**() 를 수행한다.
- **ObjectInputStream**을 만든다.
- byte[] getSerialzedObject를 만든 후 대상 객체를 **readObject**(Object) 한다.

<br/>

**사용하지 않는 이유?**

- **보안 - readObject에는 Validation Logic이 적용되어 있지 않다.**
    - 악의적으로 직렬화 바이트 **배열의 내부 값을 수정**한다면 **다른 결과가 나온다**.
    - 하지만 **역직렬화 하는 입장에선 해당 문제를 파악할 수 없다.**
        - **해결법 : 커스텀 직렬화를 사용한다. ( readObject 를 재정의 한다.)**
            - objectInputStream.defaultReadObject() → 기본 직렬화 수행
            - checkPositive() → 검증 로직을 수행. (만들어야 함)
        - **해결법 : 직렬화 프록시 패턴을 사용한다.**
            - 대리 역할을 하는 중첩 클래스를 생성하여 사용한다.

- **유지보수성**
    - **장기간 정보를 저장하지 않아야한다. (구조의 변경에 따른 예외가 발생할 수 있다.)**
    - **용량 문제** : 직렬화시에 **객체의 타입 정보 등 클래스의 메타 정보**도 가지고 있기에,     **다른 포맷에 비해서 상대적으로 많은 용량**을 차지한다.
        - **트래픽이 지속적으로 증가한다면 다른 포맷의 직렬화를 선택해야 한다.**

- **테스트**
- **싱글톤 문제**
    - 직렬화를 수행하게 되면 직렬화된 객체와 역직렬화 된 객체는 다른 객체가 된다.

- **역직렬화 문제**
    - **역직렬화 대상의 클래스의 멤버 변수 타입 변경을 지양해야 한다.**
        - 타입 변경이 되면 직렬화된 데이터가 존재하는 상태일 때 발생할 예외를 신경  써야 한다.

<br/>

**다른 좋은 방법은?**

- JSON
- CSV
- Protocol Buffer